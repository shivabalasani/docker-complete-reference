------------------------------------------ Section 2 --------------------------------------------------------------------
Docker Commands :-
docker version
docker run hello-world

docker run busybox echo hi there
docker run busybox ls
docker run hello-world ls (error)

List all running containers: docker ps
docker run busybox ping google.com
List all containers that we have ever created : docker ps --all 

docker run = docker create + docker start

Create a Container : docker create <image name>
Start a Container : docker start <container id>

docker create hello-world (will generate id of the container that is created)
docker start -a 9271d.....21e (-a will watch for output from the container and prints it out on my terminal)

Restarting Stopped Containers : docker start -a 37a8c45a23e1
Removing Stopped Containers : docker system prune

Retrieving Log Outputs : dock logs <container id>
Stopping Containers : docker stop <container id> ( Terminate signal (SIGTERM) sent to running process and waits 10 seconds)
					  docker kill <container id> ( Kill signal (SIGKILL) sent to running process to terminate immediately)
					  

Multi-Command Containers : docker run redis						   
						   redis-server / redis-cli
						   
Executing Commands in Running Containers : docker exec -it <container id> <command>
										   docker exec -it 37a8c45a23e1 redis-cli
										   set myvalue 5 / get myvalue
										   
The purpose of the IT Flag : docker exec -it 37a8c45a23e1 redis-cli
							 docker exec -i -t 37a8c45a23e1 redis-cli (-i ensures any stuff that I type gets directed to STDIN of the running process.-t makes all the text show up a little bit pretty)
							 Every process in linux environment has STDIN/STDOUT/STDERR
							 docker exec -i 37a8c45a23e1 redis-cli

Getting a command prompt in a container : docker exec -it 37a8c45a23e1 sh ( Outputs #. Now can run any unix commands like cd /, ls. Ctrl + D or exit to exit)
										  In MacOS it is bash
										  In windows it is gitbash or powershell
										  In Unix zsh(Z shell)   
										  sh (shell)
										  
Starting with a shell : docker exec -it 37a8c45a23e1 sh
						docker run -it busybox sh ( Outputs #)
						
Container Isolation : docker run -it busybox sh (touch hithere to creates a new file. Multiple instances of the shell won't have the hithere file. Two running containers will have seperate file systems and data won't be shared)
										  
								
--------------------------------------------------------- Section 3 --------------------------------------------------------------------
Dockerfile - Configuration to define how our container should behave. Dockerfile -> Docker Client -> Docker Server -> Usable Image!
Creating a Dockerfile - Specify a base image -> Run some commands to install additional programs -> Specify a command to run on container startup.

Building a Dockerfile : Create an image that runs redis-server
						mkdir redis-image
						cd redis-image
												  (#User an existing docker image as a base / Download and install a dependency /  Tell the image what to do when it starts as a container)	
						code .  Create Dockerfile (FROM alpine 								/RUN apk add --update redis 		/ CMD ["redis-server"])
						docker build .
						docker run fc60771eaa08
						
Writing a dockerfile  == Being given a computer with no OS and being told to install Chrome.

Tagging an Image : docker build -t yourdockerid/RepoorProjectname:version .
				   docker build -t sbalasani/redis:latest .
				   docker run sbalasani/redis
				   
Manual Image generation with Docker Commit : docker run -it alpine sh
											 # apk add --update redis (Modifying file system)
							In new terminal: docker ps (get the id of the running container above)
											 docker commit -c 'CMD ["redis-server"]' fc60771eaa08
											 docker run 083589332af ( runs the image created above)


--------------------------------------------------------- Section 4 --------------------------------------------------------------------

Go to simpleweb
Build an image : docker build .

COPY 	./ 			./  ->(Place to copy stuff to inside *the container*)
		 |
		 \/
(Path to folder to copy from on *your machine* relative to build context)


Build an image with tag : docker build -t sbalasani/simpleweb .

Start the image : docker run sbalasani/simpleweb 
http://localhost:8080 (Error)

Docker run with Port Mapping : docker run -p 8080 : 8080 <image id>
					(Route incoming request to this port on local host to  : this port inside the container)
							   docker run -p 8080 : 8080 sbalasani/simpleweb

http://localhost:8080

Running shell inside the container : docker run -it sbalasani/simpleweb sh
		 					or 	   : docker exec -it eeed31ee65c6 sh (Should go to /usr/app #)
ls
exit

------------------------------------ Section 5 :  Docker Compose with Multiple Local Containers--------------------------------------------

Go to visits
Build an image : docker build .
Build an image with tag : docker build -t sbalasani/visits:latest .
Start the image : docker run sbalasani/visits 

Running Redis on a seperate container : docker run redis
Start the image : docker run sbalasani/visits 

Options for connecting Node App Container with Redis Container
1) Use Docker CLI's Networking Features
2) Use Docker Compose

Docker Compose 
	1) Seperate CLI that get installed along with Docker.
	2) Used to start up multiple Docker containers at the same time.
	3) Automates some of the long-winded arguments we were passing to 'docker run'

Docker Compose commands : docker-compose up   		(same as docker run myimage)
						  docker-compose up --build (same as  docker build . and docker run myimage)	

Stopping Docker Compose Containers : docker run -d redis	  (Lanunch single container)
									 docker stop ba1220ea9edc (Stop single container)

									 docker-compose up -d (Launch all containers in backgroud)
									 docker-compose stop  (Stop all containers)

Container Maintenance with Compose  
Automatic Container Restarts :  restart: always (add this to the container you want to restart in docker-compose.yml)

	Status Codes :  0 - We exited and everthing is OK
				  1,2,3 etc - We exited because something went wrong!
	
	Restart Policies : "no" - Never attempt to restart this. container if it stops or crashes. Need to be in quotes in yml file
						always - If this container stops *for any reason* always attempt to restart it.
						on-failure - Only restart if the container stops with and error code.
						unless-stoppped - Always restart unless we forcibly stop it.

Container Status with Docker Compose : docker-compose ps (Prints out the statuses of the containers that are running)
localhost:4001

------------------------------------ Section 6 :  Creating a Production-Grade Workflow--------------------------------------------
Instead of this:
npm install -g create-react-app
create-react-app frontend

Just do this:
npx create-react-app frontend

npm run start - Starts up a development server. For development use only
npm run test - Runs tests associated with the project
npm run build - Builds a production version of the application

Build an image using Dev Dockerfile : docker build -f Dockerfile.dev .
Duplicating dependencies : remove node_modules folder

Starting the container : docker run ba1220ea9edc (Error)
						 docker run -p 3000:3000 ba1220ea9edc

Create-React-App has some issues detecting when files get changed on Windows based machines.  To fix this, please do the following:
In the root project directory, create a file called .env
Add the following text to the file and save it: CHOKIDAR_USEPOLLING=true

Docker Volumes: set mapping from folder inside the container to the local folder so that changes are reflected immediately
				
				docker run -p 3000:3000 -v /app/node_modules -v $(pwd):/app <image_id>
				puts a bookmark on the node_modules folder and maps the present working directory(pwd) into the /app folder.
				use gitbash to run the above command.

				If you are on Windows, the command needs a minor change:
				docker run -p 3000:3000 -v /app/node_modules -v pwd:/app CONTAINER_ID

				Windows 10 Pro w/ Docker Desktop students have noted this variation to work with GitBash:
				docker run -p 3000:3000 -v /app/node_modules -v ${pwd}:/app CONTAINER_ID

Shorthand with Docker Compose : Add docker-compose.yml 
								docker-compose up

								docker run ba1220ea9edc npm run test
								docker run -it ba1220ea9edc npm run test

Live updating tests			 :  Solution 1
								docker-compose up
								docker exec -t ba1220ea9edc npm run test

								Solution 2
								Update docker-compose.yml to include tests service
								docker-compose up --build

								docker attach ba1220ea9edc ( Attach terminal to the containers stdin/stdout/stderr)
								docker exec -it ba1220ea9edc sh (Shell inside the container)
								# ps

Multi-Step Docker Builds : Create Dockerfile for production
Running Nginx			 : docker build . 
						   docker run -p 8080:80 ba1220ea9edc
localhost:8080


------------------------------------ Section 7 :  Continuous integration and deployment with AWS-------------------------------------------

Create .travis.yml file and 
	1) Tell Travis we need a copy of docker running.
	2) Build our image using Dockerfile.dev.
	3) Tell Travis how to run our test suite.
	4) Tell Travis how to deploy our code to AWS.

git checkout -b feature
git add .
git push origin feature

Create and merge pull request from feature to master

------------------------------------ Section 8 :  Building a Multi-Container Application -------------------------------------------

------------------------------------ Section 9 :  Dockerizing Multiple Services ----------------------------------------------------
Go to complex
cd client
Build an image using Dev Dockerfile:  docker build -f Dockerfile.dev .
Run the container : 				  docker run ba1220ea9edc

cd server
Build an image using Dev Dockerfile:  docker build -f Dockerfile.dev .
Run the container : 				  docker run ba1220ea9edc

cd worker
Build an image using Dev Dockerfile:  docker build -f Dockerfile.dev .
Run the container : 				  docker run ba1220ea9edc

Go to complex-elastic-beanstalk
docker-compose up --build

------------------------------------ Section 10 :  Continuous Integration Workflow for Multiple Images -------------------------------
Add .travis.yml file to push images to docker hub

------------------------------------ Section 11 :  Multi-Container Deployments to AWS -------------------------------